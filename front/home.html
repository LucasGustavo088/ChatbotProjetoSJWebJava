<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">
<meta name="author" content="">
<link rel="shortcut icon" href="assets/images/logo-icon.png">

<title>Cartório Projeto Interdisciplinar</title>

<!-- Bootstrap core CSS -->
<link href="assets/css/bootstrap.css" rel="stylesheet">
<link href="assets/css/font-awesome.min.css" rel="stylesheet">

<!-- Custom styles for this template -->
<link href="assets/css/main.css" rel="stylesheet">
<link href="assets/css/bootstrap.min.css" rel="stylesheet">
<link href="assets/css/home.css" rel="stylesheet">
<!-- Scripts -->
<!--===============================================================================================-->
<script src="assets/vendor/jquery/jquery-3.2.1.min.js"></script>
<script src="assets/js/jquery-ui-1.12.1.custom/jquery-ui.min.js"></script>
<!--===============================================================================================-->
<script src="assets/vendor/animsition/js/animsition.min.js"></script>
<!--===============================================================================================-->
<script src="assets/vendor/bootstrap/js/popper.js"></script>
<script src="assets/vendor/bootstrap/js/bootstrap.min.js"></script>
<!--===============================================================================================-->

<script
	src="assets/fonts\fontawesome-free-5.0.8\svg-with-js\js\fontawesome-all.js"></script>

</head>

<body>

	<!-- Fixed navbar -->
	<div class="navbar navbar-inverse navbar-fixed-top">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse"
					data-target=".navbar-collapse">
					<span class="icon-bar"></span> <span class="icon-bar"></span> <span
						class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="#">CART<i class="fa fa-circle"></i>RIO
				</a>
			</div>
			<div class="navbar-collapse collapse">
				<ul class="nav navbar-nav navbar-right">
					<li><a href="#">HOME</a></li>
					<li><a href="#red">OBJETIVO</a></li>
					<li><a href="#eq">EQUIPE</a></li>
					<li><a href="#ser">COMO FUNCIONA</a></li>
					<li><a
						href="http://localhost:8080/ChatbotProjetoSJWebJava/autorizacao/login">LOGIN</a></li>
					<li><a data-toggle="modal" data-target="#myModal"
						href="#myModal"><i class="fa fa-envelope-o"></i></a></li>
				</ul>
			</div>
			<!--/.nav-collapse -->
		</div>
	</div>

	<div id="headerwrap" src="assets/images/header-bg.jpg">
		<div class="container">
			<div class="row centered">
				<div class="col-lg-8 col-lg-offset-2">
					<br></br>
					<h1>
						Esclareça Suas <b>Dúvidas</b>
					</h1>
					<h2>Com Agilidade e Segurança</h2>
				</div>
			</div>
			<!-- row -->
		</div>
		<!-- container -->
	</div>
	<!-- headerwrap -->

	<!--Quem somos -->
	<div id="red">
		<div class="container">
			<div class="row centered">
				<div class="col-lg-8 col-lg-offset-2">
					<br></br> <br></br> <img src="assets/images/maoV.png" width="400"
						height="250" alt="">
				</div>
			</div>
			<!-- row -->
		</div>
		<!-- container -->


		<div id="r">
			<div class="container">
				<div class="row centered">
					<div class="col-lg-8 col-lg-offset-2">
						<h4>SOBRE O PROJETO/CARTÓRIO CHATBOT</h4>
						<p>O Cartório Chatbot é um Projeto Integrado elaborado pelos
							pelos alunos de Ciências da Computação da USJT 3° semestre,
							orientado pelos professores Nelson Aguiar e Rodrigo Bossini, o
							projeto visa melhoria nos meios de comunicação dentro de serviços
							referente a Cartório. O objetivo do projeto é o desenvolvimento
							de um Chatbot, software que trabalha e gerencia trocas de
							mensagem, de forma fácil e segura. O Chatbot tem as funções de
							interagir com o usuário para responder a perguntas frequentes e
							aprender com as interações do usuário.</p>
					</div>
				</div>
				<!-- row -->
			</div>
			<!-- container -->
		</div>
		<! -- r wrap -->

		<!--  Equipe -->
		<div id="eq">
			<div class="container w">
				<div class="row centered">
					<h4>NOSSA EQUIPE</h4>
					<br></br>
					<div class="col-lg-4">
						<img class="img-circle" src="assets/images/pic2.jpg" width="110"
							height="110" alt="">
						<h4>Victoria Chelsea</h4>
						<p>
							Sócio fundadora da empresa Cartório Chatbot<br> Ciêntista da
							Computação<br> Brasileira <br> RA: 81716252
						</p>
						<p>
							<a href="#">@Victoria_Chelsea</a>
						</p>
					</div>
					<!-- col-lg-3 -->

					<div class="col-lg-4">
						<img class="img-circle" src="assets/images/pic3.jpg" width="110"
							height="110" alt="">
						<h4>Bruna Gabriella</h4>
						<p>
							Sócio fundadora da empresa Cartório Chatbot<br> Ciêntista da
							Computação<br> Brasileira <br> RA: 817124071
						</p>
						<p>
							<a href="#">@Bruna_Gabriella</a>
						</p>
					</div>
					<!-- col-lg-3 -->

					<div class="col-lg-4">
						<img class="img-circle" src="assets/images/pic4.jpg" width="110"
							height="110" alt="">
						<h4>Lucas Gustavo</h4>
						<p>
							Sócio fundador da empresa Cartório Chatbot<br> Ciêntista da
							Computação<br> Brasileiro <br> RA: 81622845
						</p>
						<p>
							<a href="#">@Lucas_Gustavo</a>
						</p>
					</div>
					<!-- col-lg-3 -->
					<div class="row centered">
						<div class="col-lg-8 col-lg-offset-2">
							<br></br>
							<h4>
								"Tudo o que é simples, que simplifica a vida de todos nós,
								merece destaque." </b>
							</h4>
						</div>
					</div>
					<!-- row -->

				</div>
				<!-- row -->
			</div>
			<!-- container -->
		</div>
		<!-- eq -->

		<!-- Serviços -->
		<div id=ser>
			<div id="myCarousel" class="carousel slide" data-ride="carousel">
				<!-- Carousel indicators -->
				<ol class="carousel-indicators">
					<li data-target="#myCarousel" data-slide-to="0" class="active"></li>
					<li data-target="#myCarousel" data-slide-to="1"></li>
					<li data-target="#myCarousel" data-slide-to="2"></li>
					<li data-target="#myCarousel" data-slide-to="3"></li>
					<li data-target="#myCarousel" data-slide-to="4"></li>
					<li data-target="#myCarousel" data-slide-to="5"></li>
					<li data-target="#myCarousel" data-slide-to="6"></li>
				</ol>
				<!-- Wrapper for carousel items -->
				<div class="carousel-inner">
					<div class="item active">
						<img src="slides/Slide1.jpg" alt="First Slide">
					</div>
					<div class="item">
						<img src="slides/Slide2.jpg" alt="Second Slide">
					</div>
					<div class="item">
						<img src="slides/Slide3.jpg" alt="Third Slide">
					</div>
					<div class="item">
						<img src="slides/Slide4.jpg" alt="Third Slide">
					</div>
					<div class="item">
						<img src="slides/Slide5.jpg" alt="Third Slide">
					</div>
					<div class="item">
						<img src="slides/Slide6.jpg" alt="Third Slide">
					</div>
					<div class="item">
						<img src="slides/Slide7.jpg" alt="Third Slide">
					</div>
				</div>
				<!-- Carousel controls -->
				<a class="carousel-control left" href="#myCarousel"
					data-slide="prev"> <span
					class="glyphicon glyphicon-chevron-left"></span>
				</a> <a class="carousel-control right" href="#myCarousel"
					data-slide="next"> <span
					class="glyphicon glyphicon-chevron-right"></span>
				</a>
			</div>
		</div>

		<!-- FOOTER -->
		<div id="f">
			<div class="container">
				<div class="row centered">
					<a href="#"><i class="fa fa-twitter"></i></a><a href="#"><i
						class="fa fa-facebook"></i></a><a href="#"><i
						class="fa fa-dribbble"></i></a>

				</div>
				<!-- row -->
			</div>
			<!-- container -->
		</div>
		<!-- Footer -->

		<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
		<div class="row chat-window col-xs-5 col-md-3" id="chatbot1"
			style="margin-left: 10px;">
			<div class="col-xs-12 col-md-12">
				<div class="panel panel-default">
					<div class="panel-heading top-bar grabbable">
						<div class="col-md-8 col-xs-8">
							<h3 class="panel-title">
								<strong>Chatbot Cartório</strong>
							</h3>
						</div>
						<div class="col-md-4 col-xs-4" style="text-align: right;">
							<a href="#/"><span id="minim_chat_window"
								class="glyphicon glyphicon-minus icon_minim"></span></a>
						</div>
					</div>
					<div class="panel-body msg_container_base" style="height: 300px;"
						id="base_mensagens"></div>
					<div class="panel-footer">
						<input id="mensagem_input" type="text" class="form-control"
							placeholder="Escreva aqui..." />
					</div>
				</div>
			</div>
		</div>
		<div id="clone_usuario_mensagem" style="display: none;">
			<div class="row msg_container base_sent">
				<div class="col-md-10 col-xs-10">
					<div class="messages msg_sent">
						<p>$mensagem</p>
						<time datetime="2009-11-13T20:00">dados_usuario.nome •
							Agora mesmo</time>
					</div>
				</div>
				<div class="col-md-2 col-xs-2 avatar">
					<img
						src="http://www.bitrebels.com/wp-content/uploads/2011/02/Original-Facebook-Geek-Profile-Avatar-1.jpg"
						class=" img-responsive ">
				</div>
			</div>
		</div>

		<!-- CLONES -->
		<div id="clone_chatbot_mensagem" style="display: none;">
			<div class="row msg_container base_receive"
				id="clone_chatbot_mensagem$id">
				<div class="col-md-2 col-xs-2 avatar">
					<img
						src="http://www.bitrebels.com/wp-content/uploads/2011/02/Original-Facebook-Geek-Profile-Avatar-1.jpg"
						class=" img-responsive ">
				</div>
				<div class="col-xs-10 col-md-10">
					<div class="messages msg_receive">
						<p>$mensagem</p>
						<time datetime="2009-11-13T20:00">
							<span id="entidade$id">Chatbot • Agora mesmo</span>
							<br>
							<button
								onclick="finalizar_atendimento(); resposta_satisfatoria($id_pergunta_resposta)"
								style="width: 57px; height: 20px; font-size: 8px;"
								class="btn btn-success satisfacao" type="button">Satisfeito</button>
							<button
								onclick="proxima_resposta();"
								style="width: 70px; height: 20px; font-size: 8px;"
								class="btn btn-danger satisfacao nao_satisfeito" type="button">Não satisfeito</button>
						</time>
					</div>
				</div>
			</div>
		</div>
		<div id="clone_identificacao" style="display: none;">
			<div id="identificacao" class="col-md-12" style="margin-top: 20px;">
				<div class="row form-group">
					<h5 style="text-align: center">Preencha os campos abaixo para
						iniciar o atendimento:</h5>
				</div>
				<div class="form-group row" style="margin-top: 10px;">
					<label for="nome" class="col-sm-2 control-label">Nome</label>
					<div class="col-sm-10">
						<input type="nome" name="dados_usuario[nome]"
							placeholder="Digite seu nome" class="form-control col-md-10"
							id="nome" />
					</div>
				</div>
				<div class="form-group row" style="margin-top: 10px;">
					<label for="email" class="col-sm-2 control-label">Email</label>
					<div class="col-sm-10">
						<input type="email" name="dados_usuario[email]"
							placeholder="Digite seu e-mail" class="form-control col-md-10"
							id="email" />
					</div>
				</div>
				<div class="form-group row" style="margin-top: 20px;">
					<button style="margin-left: 100px;" id="enviar_informacoes_usuario"
						type="button" class="btn btn-success">Enviar</button>
				</div>
			</div>
		</div>
		<script>

      var ultimas_mensagens_usuario = [];
      var quantidade_resposta = 0;
      var id_atendimento = '';
      var travar_atualizacao = false;
      var dados_usuario = {
        nome: '',
        email: '' 
      };
      var contador_clone_chatbot_mensagem = 0;
      var enderecoBack = 'http://localhost:8080/ChatbotProjetoSJWebJava/';

      $(document).ready(function() {
          inicializar_chatbot();

          $('#nome').val('Joana Maria');
          $('#email').val('joana@email.com');
          
          document.querySelector('#mensagem_input').addEventListener('keypress', function (e) {
              var key = e.which || e.keyCode;
              if (key === 13) { // 13 é enter
                  enviar_mensagem();  
              }
          });

          $('#enviar_informacoes_usuario').click(function() {
            salvar_informacoes_usuario();
          });
      });

      $( function() {
       // $( "#chatbot1" ).draggable();
      } );
      $(document).on('click', '.panel-heading span.icon_minim', function (e) {
        var $this = $(this);
        if (!$this.hasClass('panel-collapsed')) {
            $this.parents('.panel').find('.panel-body').slideUp();
            $this.addClass('panel-collapsed');
            $this.removeClass('glyphicon-minus').addClass('glyphicon-plus');
        } else {
            $this.parents('.panel').find('.panel-body').slideDown();
            $this.removeClass('panel-collapsed');
            $this.removeClass('glyphicon-plus').addClass('glyphicon-minus');
        }
      });
      $(document).on('focus', '.panel-footer input.chat_input', function (e) {
        var $this = $(this);
        if ($('#minim_chat_window').hasClass('panel-collapsed')) {
            $this.parents('.panel').find('.panel-body').slideDown();
            $('#minim_chat_window').removeClass('panel-collapsed');
            $('#minim_chat_window').removeClass('glyphicon-plus').addClass('glyphicon-minus');
        }
      });
      $(document).on('click', '#new_chat', function (e) {
        var size = $( ".chat-window:last-child" ).css("margin-left");
         size_total = parseInt(size) + 400;
        alert(size_total);
        var clone = $( "#chatbot1" ).clone().appendTo( ".container" );
        clone.css("margin-left", size_total);
      });
      $(document).on('click', '.icon_close', function (e) {
        //$(this).parent().parent().parent().parent().remove();
        $( "#chatbot1" ).remove();
      });

      function atualizar_chat() {
        if(travar_atualizacao) {
          return false;
        }

        $('#base_mensagens').html('');

        $.ajax({
            url: enderecoBack + 'chatbot_dialog/carregar_mensagens_chat/' + id_atendimento,
            dataType: 'json',
            method: 'get',
            async: false,
            data: {
                // '_token': "{{ csrf_token() }}",
            },
            success: function(retorno) {
              if(retorno.atendimento != null) {
                retorno.atendimento.chat.forEach(function(chat) {
                  if(chat["resposta"] != undefined) {
                    adicionar_mensagem_usuario_atendente_caixa(chat.resposta.descricao);
                  } else if (chat["pergunta"] != undefined) {
                    adicionar_mensagem_usuario_caixa(chat.pergunta.descricao)
                  }
                });
              }
            },
        });

        scroll_down_mensagem_enviada();
      }

      function adicionar_mensagem_usuario_atendente_caixa(mensagem) {
        var clone_usuario_chatbot = $('#clone_chatbot_mensagem').html();
        clone_usuario_chatbot = str_replace('$mensagem', mensagem, clone_usuario_chatbot);
        clone_usuario_chatbot = str_replace('$id_pergunta_resposta', null, clone_usuario_chatbot);
        clone_usuario_chatbot = str_replace('$id', contador_clone_chatbot_mensagem, clone_usuario_chatbot);
		
        $('#base_mensagens').append(clone_usuario_chatbot);
        
        if(contador_resposta > 2) {
        	  $('#entidade' + contador_clone_chatbot_mensagem).text('Atendente • Agora mesmo');
        	  $('#clone_chatbot_mensagem' + contador_clone_chatbot_mensagem + ' .nao_satisfeito').remove();
          }
        
        contador_clone_chatbot_mensagem++;
      }
      
      function desabilitar_envio() {
    	    $('#mensagem_input').prop('disabled', true);
    	    $('#mensagem_input').attr('placeholder', '...');
    	    $('#botao_enviar_mensagem').hide();
   	  }

   	  function habilitar_envio() {
   	    $('#mensagem_input').prop('disabled', false);
   	    $('#mensagem_input').attr('placeholder', 'Escreva aqui...');
   	    $('#botao_enviar_mensagem').show();
   	  }

      function enviar_mensagem() {
        if($('#mensagem_input').val() != '') {
            adicionar_mensagem_usuario();
			
            obter_resposta_ajax($('#mensagem_input').val());
            
            scroll_down_mensagem_enviada();
            
            setTimeout(function() {
                proxima_resposta();
                scroll_down_mensagem_enviada();
            }, 200);
        } 
      }

      function finalizar_atendimento() {
        $('#base_mensagens').html('');
        $('#base_mensagens').append('<br><br><h4 style="text-align: center"><strong>Obrigado!</strong></h4><br><br><br><button type="button" class="btn btn-success" style="margin-left: 60px;" onclick="location.reload();">Perguntar novamente</button>');
        travar_atualizacao = true;
        $.ajax({
            url: enderecoBack + 'chatbot_dialog/finalizar_atendimento',
            dataType: 'json',
            method: 'post',
            async: false,
            data: {
                // '_token': "{{ csrf_token() }}",
                id_atendimento: id_atendimento
            },
            error: function() {
              alert('Ops, houve um erro interno ao finalizar o atendimento.');
            }
        });
      }

      function salvar_informacoes_usuario() {
        if($('#nome').val() == '' || $('#email').val() == '') {
          alert('Insira os valores para iniciar o atendimento');
        } else {
          dados_usuario.nome = $('#nome').val();
          dados_usuario.email = $('#email').val();

          salvar_atendimento();

          $('#base_mensagens #identificacao').remove();
          $('#mensagem_input').prop('disabled', false);
			
          var mensagem_chatbot = {};
          mensagem_chatbot.resposta = "Olá " + dados_usuario.nome + ". Em que posso te ajudar?";
          mensagem_chatbot.id_pergunta_resposta = -1;
          
          adicionar_mensagem_chatbot_caixa(mensagem_chatbot, true);
        }
      }

      function salvar_atendimento() {
        $.ajax({
            url: enderecoBack + 'chatbot_dialog/salvar_atendimento',
            dataType: 'json',
            method: 'post',
            async: false,
            data: {
                // '_token': "{{ csrf_token() }}",
                'nome': dados_usuario.nome,
                'email': dados_usuario.email,
            },
            success: function(retorno) {
                if(retorno.atendimento.id == "") {
                    alerta_erro();
                }
                id_atendimento = retorno.atendimento.id;
            },
            error: function() {
                alerta_erro();
            }
        });
      }

      function alerta_erro() {
            alert('Ops, houve um erro interno. Verifique minha conexão.');
      }

      function inicializar_chatbot() {
        $('#base_mensagens').html('');
        adicionar_identificacao();
        colocar_tela_chatbot_canto();
      }

      function adicionar_identificacao() {
        var clone_identificacao = $('#clone_identificacao').html();
        $('#base_mensagens').append(clone_identificacao);
        $('#mensagem_input').attr('disabled', 'disabled');
      }

      function colocar_tela_chatbot_canto() {
        $('#chatbot1').css('right', '0px');
        $('#chatbot1').css('bottom', '0px');
      }

      var contador_resposta = -1;
      function adicionar_mensagem_usuario() {
        //Histórico de mensagens do usuário
        adicionar_log_ultima_mensagem_usuario();
        
        adicionar_mensagem_usuario_caixa(obter_log_ultima_mensagem_usuario().mensagem);
        
        $('#mensagem_input').focus();
        $('#mensagem_input').val('');
        salvar_mensagem_banco('pergunta');
      }

      function adicionar_mensagem_usuario_caixa(mensagem) {
        var clone_usuario_mensagem = $('#clone_usuario_mensagem').html();
        clone_usuario_mensagem = str_replace('dados_usuario.nome', dados_usuario.nome, clone_usuario_mensagem)
        clone_usuario_mensagem = str_replace('$mensagem', mensagem, clone_usuario_mensagem);
        $('#base_mensagens').append(clone_usuario_mensagem);
      }

      function salvar_mensagem_banco(pergunta_ou_resposta) {
        if(pergunta_ou_resposta == 'pergunta') {
          $.ajax({
              url: enderecoBack + 'chatbot_dialog/salvar_mensagem_banco/pergunta/' + id_atendimento,
              dataType: 'json',
              method: 'get',
              async: false,
              data: {
                  // '_token': "{{ csrf_token() }}",
                  dados_mensagem: obter_log_ultima_mensagem_usuario()
              },
              success: function(retorno) {
                  mensagem_chatbot = retorno.DESCRICAO;
              },
              error: function() {
                mensagem_chatbot = 'Ops, houve um erro interno.';
              }
          });
        }
      }

      function adicionar_log_ultima_mensagem_usuario() {
        ultimas_mensagens_usuario.push({
            mensagem: $('#mensagem_input').val(),
            data: new Date()
        });
      }

      function obter_log_ultima_mensagem_usuario() {
        if(ultimas_mensagens_usuario.length != 0) {
            return ultimas_mensagens_usuario.slice(-1)[0]; 
        } else {
            return 'Olá';
        }
      }
      
      function inicializar_atendimento() {
    	  habilitar_envio();
    	  alert('Por favor, aguarde. Estamos iniciando o atendimento');
          setInterval(atualizar_chat, 1500);
          atualizar_status_atendimento('atendimento_iniciado');
      }

      function proxima_resposta(mensagem, nao_perguntar_satisfacao) {
    	  
    	  if(contador_resposta <= 2) {
    		  desabilitar_envio();  
    	  } else {
    		  habilitar_envio();
    	  }
    	  
    	  
        if(contador_resposta == 2) {
          contador_resposta++;
          inicializar_atendimento();
          return false;
        } else {
        	contador_resposta++;
        }
        
       
        if(typeof respostas_chatbot[contador_resposta] != 'undefined') {
        	adicionar_mensagem_chatbot_caixa(respostas_chatbot[contador_resposta]);	
        }
        
        if(contador_resposta >= 2) {
            return false;
        }       
        
        //adicionar_mensagem_chatbot_caixa();
      }
      
      function adicionar_mensagem_chatbot_caixa(mensagem_chatbot, nao_perguntar_satisfacao) {
    	  var clone_usuario_chatbot = $('#clone_chatbot_mensagem').html();
          clone_usuario_chatbot = str_replace('$id_pergunta_resposta', mensagem_chatbot.id_pergunta_resposta, clone_usuario_chatbot);
          clone_usuario_chatbot = str_replace('$mensagem', mensagem_chatbot.resposta, clone_usuario_chatbot);
          clone_usuario_chatbot = str_replace('$id', contador_clone_chatbot_mensagem, clone_usuario_chatbot);
		
          $('#base_mensagens').append(clone_usuario_chatbot);
          
          if(nao_perguntar_satisfacao) {
          	$('#clone_chatbot_mensagem' + contador_clone_chatbot_mensagem + ' .satisfacao').remove();
          }
          
          if(contador_resposta > 2) {
        	  $('#entidade' + contador_clone_chatbot_mensagem).text('Atendente • Agora mesmo');
        	  $('#clone_chatbot_mensagem' + contador_clone_chatbot_mensagem + ' .nao_satisfeito').remove();
          }
          
          scroll_down_mensagem_enviada();
          contador_clone_chatbot_mensagem++;
      }

      function atualizar_status_atendimento(status) {
        $.ajax({
            url: enderecoBack + 'chatbot_dialog/atualizar_status_atendimento',
            dataType: 'json',
            method: 'post',
            async: false,
            data: {
                // '_token': "{{ csrf_token() }}",
                'status': status,
                'id_atendimento': id_atendimento
            },
            error: function() {
              alert('Ops, houve um erro interno.')
            }
        });
      }

      function str_replace(find,replaceTo, str){
          find = find.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
          var re = new RegExp(find, 'g');
          str = str.replace(re,replaceTo);

          return str;
      }
      
      var respostas_chatbot = [];
      function obter_resposta_ajax(mensagem_usuario) {
        
        var resposta_chatbot = {};
        
        resposta_chatbot.resposta = 'Ops, houve um erro interno e não consegui achar o que procura. Verifique minha conexão.';
        resposta_chatbot.id_pergunta_resposta = -1;
        
        $.ajax({
            url: enderecoBack + 'chatbot_dialog/obter_resposta_ajax',
            dataType: 'json',
            method: 'post',
            async: false,
            data: {
                // '_token': "{{ csrf_token() }}",
                'mensagem_usuario': obter_log_ultima_mensagem_usuario().mensagem,
            },
            success: function(retorno) {
            	console.log(retorno);
            	if(retorno.length != 0) {
            		respostas_chatbot = [];
            		respostas_chatbot.push(retorno);	
            	} else {
            		respostas_chatbot = [];
            	}
            	
                //resposta_chatbot.resposta = retorno.perguntaHasResposta.resposta.descricao;
                //resposta_chatbot.id_pergunta_resposta = retorno.perguntaHasResposta.id;
            }, 
            error: function() {
              alerta_erro();
            }
        });
        
        organizar_respostas();
      }
      
      
      function organizar_respostas() {
    	  if(respostas_chatbot.length != 0) {
    		  respostas_chatbot = 
        		  respostas_chatbot[0].sort(function (a, b) {
        			  if (a.peso_pergunta > b.peso_pergunta) {
        			    return 1;
        			  }
        			  if (a.peso_pergunta < b.peso_pergunta) {
        			    return -1;
        			  }
        			  // a must be equal to b
        			  return 0;
        			}).reverse();
  
    	  }
    	  
    	  console.log("respostas chatbot ordenadas")
    	  console.log(respostas_chatbot);
    	  var novas_respostas = [];
    	  var resposta_indefinida = 'Desculpe, não encontrei algo correspondente.';
    	  for(var i = 0; i < 3; i++) {
    		  
  		  	  if(typeof respostas_chatbot[i] == 'undefined') {
  		  		resposta_chatbot = {};
				resposta_chatbot.resposta = resposta_indefinida;
		        resposta_chatbot.id_pergunta_resposta = -1;
		        
		        novas_respostas.push(resposta_chatbot);
		        console.log('1: ' + i);
  		  	  } else {
  		  		console.log('2: ' + i)
  		  		resposta_chatbot = {};
  		  		resposta_chatbot.id_pergunta_resposta = -1;	  
  		  	
  		  		if(typeof respostas_chatbot[i].perguntaHasResposta == 'undefined' || respostas_chatbot[i].perguntaHasResposta.length == 0) {
  		  			resposta_chatbot.resposta = resposta_indefinida;	
  		  		} else if(typeof respostas_chatbot[i].perguntaHasResposta.resposta == 'undefined' || respostas_chatbot[i].perguntaHasResposta.resposta.length == 0) {
  		  			resposta_chatbot.resposta = resposta_indefinida;
  		  		} else if (typeof respostas_chatbot[i].perguntaHasResposta.resposta.descricao == ''){
  		  			resposta_chatbot.resposta = resposta_indefinida;
  		  		} else {
  		  			resposta_chatbot.resposta = '';
  		  			if(i > 0) {
  		  				resposta_chatbot.resposta += 'Ok, vamos tentar de novo: '; 
  		  			}
  		  			resposta_chatbot.resposta += respostas_chatbot[i].perguntaHasResposta.resposta.descricao;
  		  			resposta_chatbot.id_pergunta_resposta = respostas_chatbot[i].perguntaHasResposta.id;
  		  		}
  		  		
  		  		novas_respostas.push(resposta_chatbot);

  		  	  }
  		  	  
    	  }
    	  
    	  respostas_chatbot = novas_respostas;
    }

      function compare(a, b){
        let comparison = 0;

        if (a.peso_pergunta > b.peso_pergunta) {
          comparison = 1;
        } else if (b.peso_pergunta > a.peso_pergunta) {
          comparison = -1;
        }

        return comparison;
      }

      function scroll_down_mensagem_enviada() {
        var scrollHeight = document.getElementById('base_mensagens').scrollHeight;
        document.getElementById('base_mensagens').scrollTop = scrollHeight;
      }

      function resposta_satisfatoria(id_pergunta_resposta) {
        if(typeof id_pergunta_resposta == 'undefined' || id_pergunta_resposta == null) {
          return false;
        }

        $.ajax({
            url: enderecoBack + 'chatbot_dialog/resposta_satisfatoria',
            dataType: 'json',
            method: 'post',
            data: {
                // '_token': "{{ csrf_token() }}",
                'id_pergunta_resposta': id_pergunta_resposta,
            },
            success: function(retorno) {
            },
            error: function() {
            }
        });
      }
    </script>

		<!-- Bootstrap core JavaScript
    ================================================== -->
		<!-- Placed at the end of the document so the pages load faster -->
		<script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
		<script src="assets/js/bootstrap.min.js"></script>
</body>
</html>
